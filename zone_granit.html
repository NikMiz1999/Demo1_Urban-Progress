<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–î–µ—Ç–∞–ª–∏ –∑–æ–Ω—ã</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: Inter, sans-serif; background:#0f1115; color:#e9edf5; margin:0; padding:20px; }
    h2,h3 { color:#4f8cff; }
    .dashboard { display:grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap:16px; margin-bottom:20px; }
    .kpi { background:#16191f; border:1px solid #222733; border-radius:12px; padding:16px; text-align:center; }
    .kpi h3 { margin:0; font-size:14px; color:#a3a9b7; }
    .kpi p { margin:8px 0 0; font-size:22px; font-weight:bold; color:#fff; }
    .card { background:#16191f; border:1px solid #222733; border-radius:12px; padding:16px; margin-bottom:20px; }
    table { width:100%; border-collapse:collapse; margin-top:10px; }
    th, td { border:1px solid #333; padding:8px; text-align:left; }
    th { background:#1c2029; }
  </style>
</head>
<body>
  <h2>–î–µ—Ç–∞–ª–∏ –∑–æ–Ω—ã</h2>

  <!-- KPI –∫–∞—Ä—Ç–æ—á–∫–∏ -->
  <div class="dashboard">
    <div class="kpi"><h3>–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å</h3><p id="kpiProgress">‚Äì</p></div>
    <div class="kpi"><h3>–û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ –ø–æ —Å—Ä–æ–∫–∞–º</h3><p id="kpiDelay">‚Äì</p></div>
    <div class="kpi"><h3>–°—Ç–æ–∏–º–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç</h3><p id="kpiCost">‚Äì</p></div>
    <div class="kpi"><h3>–°–µ–≥–º–µ–Ω—Ç—ã</h3><p id="kpiSegments">‚Äì</p></div>
  </div>

  <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–æ–Ω—ã -->
  <div id="zoneInfo" class="card"></div>

  <!-- –ü–ª–∞–Ω-—Ñ–∞–∫—Ç —Ç–∞–±–ª–∏—Ü–∞ -->
  <div class="card">
    <h3>–ü–ª–∞–Ω‚Äë—Ñ–∞–∫—Ç —Ç–∞–±–ª–∏—Ü–∞</h3>
    <table id="planFactTable"></table>
  </div>

  <!-- –ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ -->
  <div class="card">
    <h3>–ì—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</h3>
    <canvas id="progressChart"></canvas>
  </div>

  <!-- Stacked bar chart -->
  <div class="card">
    <h3>–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ –Ω–µ–¥–µ–ª—è–º (–æ–±—ä—ë–º—ã)</h3>
    <canvas id="stackedChart"></canvas>
  </div>

  <!-- –°–≤–æ–¥–∫–∞ –ø–æ –ø–æ–¥—Ä—è–¥—á–∏–∫—É -->
  <div class="card">
    <h3>–°–≤–æ–¥–∫–∞ –ø–æ –ø–æ–¥—Ä—è–¥—á–∏–∫—É</h3>
    <table id="contractorSummary"></table>
  </div>

  <div class="card">
    <h3>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ —Å–º–µ—Ç–æ–π (–∑–æ–Ω–∞)</h3>
    <table id="budgetTable"></table>
    <canvas id="budgetChart"></canvas>
  </div>

<script>
  // —á–∏—Ç–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ URL
  const params = new URLSearchParams(window.location.search);
  const zoneId = params.get("id") || "zone_1";
  const objectId = params.get("object") || "obj_065";

  // ‚ö†Ô∏è –ø–æ–∫–∞ –¥–∞–Ω–Ω—ã–µ –º–æ–∫–æ–≤—ã–µ, –ø–æ–∑–∂–µ –º–æ–∂–Ω–æ –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞
  const zone = {
    id: zoneId,
    contractor: "–û–û–û ¬´–ì—Ä–∞–Ω–∏—Ç–°—Ç—Ä–æ–π¬ª",
    progress: 0.6,
    status: "in_progress",
    plan: { –ø–ª–∏—Ç–∫–∞: 1000, –±–æ—Ä–¥—é—Ä—ã: 433, –º–∞—Ñ—ã: 66 },
    fact: { –ø–ª–∏—Ç–∫–∞: 740, –±–æ—Ä–¥—é—Ä—ã: 400, –º–∞—Ñ—ã: 30 },
    budget: { plan: 12500000, fact: 7500000 }, // üëà –¥–æ–±–∞–≤–∏–ª–∏ —Å–º–µ—Ç—É
    weekly: { labels:["–ù–µ–¥–µ–ª—è 1","–ù–µ–¥–µ–ª—è 2","–ù–µ–¥–µ–ª—è 3","–ù–µ–¥–µ–ª—è 4"], plan:[20,40,60,100], fact:[10,35,44,60] },
    volumes: { –ø–ª–∏—Ç–∫–∞:[200,240,100,200], –±–æ—Ä–¥—é—Ä—ã:[100,120,100,100], –º–∞—Ñ—ã:[5,5,6,4] }
  };

  // KPI –∫–∞—Ä—Ç–æ—á–∫–∏
  document.getElementById("kpiProgress").textContent = (zone.progress*100).toFixed(0) + "%";
  document.getElementById("kpiDelay").textContent = "5 –¥–Ω–µ–π"; // –ø—Ä–∏–º–µ—Ä
  document.getElementById("kpiCost").textContent = "‚âà 12.5 –º–ª–Ω ‚ÇΩ"; // –ø—Ä–∏–º–µ—Ä
  document.getElementById("kpiSegments").textContent = "3 (0 –≤—ã–ø–æ–ª–Ω–µ–Ω–æ, 3 –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ, 3 –æ—Ç—Å—Ç–∞—ë—Ç)";

  // –∫–∞—Ä—Ç–æ—á–∫–∞ –∑–æ–Ω—ã
  document.getElementById("zoneInfo").innerHTML = `
    <p><strong>–ó–æ–Ω–∞:</strong> ${zone.id}</p>
    <p><strong>–ü–æ–¥—Ä—è–¥—á–∏–∫:</strong> ${zone.contractor}</p>
    <p><strong>–ü—Ä–æ–≥—Ä–µ—Å—Å:</strong> ${(zone.progress*100).toFixed(0)}%</p>
    <p><strong>–°—Ç–∞—Ç—É—Å:</strong> ${zone.status}</p>
  `;

  // —Ç–∞–±–ª–∏—Ü–∞ –ø–ª–∞–Ω‚Äë—Ñ–∞–∫—Ç
  const table = document.getElementById("planFactTable");
  table.innerHTML = `
    <tr><th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th><th>–ü–ª–∞–Ω</th><th>–§–∞–∫—Ç</th><th>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</th></tr>
    <tr><td>–ü–ª–æ—â–∞–¥—å –ø–ª–∏—Ç–∫–∏</td><td>${zone.plan.–ø–ª–∏—Ç–∫–∞} –º¬≤</td><td>${zone.fact.–ø–ª–∏—Ç–∫–∞} –º¬≤</td><td>${(zone.fact.–ø–ª–∏—Ç–∫–∞-zone.plan.–ø–ª–∏—Ç–∫–∞)} –º¬≤</td></tr>
    <tr><td>–ë–æ—Ä–¥—é—Ä—ã</td><td>${zone.plan.–±–æ—Ä–¥—é—Ä—ã} –º</td><td>${zone.fact.–±–æ—Ä–¥—é—Ä—ã} –º</td><td>${(zone.fact.–±–æ—Ä–¥—é—Ä—ã-zone.plan.–±–æ—Ä–¥—é—Ä—ã)} –º</td></tr>
    <tr><td>–ú–ê–§—ã</td><td>${zone.plan.–º–∞—Ñ—ã} —à—Ç</td><td>${zone.fact.–º–∞—Ñ—ã} —à—Ç</td><td>${(zone.fact.–º–∞—Ñ—ã-zone.plan.–º–∞—Ñ—ã)} —à—Ç</td></tr>
  `;

  // –≥—Ä–∞—Ñ–∏–∫ –¥–∏–Ω–∞–º–∏–∫–∏
  const ctx = document.getElementById('progressChart').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: zone.weekly.labels,
      datasets: [
        { label:'–ü–ª–∞–Ω', data:zone.weekly.plan, borderColor:'#4f8cff', fill:false },
        { label:'–§–∞–∫—Ç', data:zone.weekly.fact, borderColor:'#2bd27e', fill:false }
      ]
    },
    options: {
      responsive:true,
      plugins:{ legend:{ labels:{ color:'#e9edf5' } } },
      scales:{
        x:{ ticks:{ color:'#a3a9b7'} },
        y:{ ticks:{ color:'#a3a9b7'} }
      }
    }
  });

  // stacked bar chart
  const ctx2 = document.getElementById('stackedChart').getContext('2d');
  new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: zone.weekly.labels,
      datasets: [
        { label:'–ü–ª–∏—Ç–∫–∞ (–º¬≤)', data:zone.volumes.–ø–ª–∏—Ç–∫–∞, backgroundColor:'#4f8cff' },
        { label:'–ë–æ—Ä–¥—é—Ä—ã (–º)', data:zone.volumes.–±–æ—Ä–¥—é—Ä—ã, backgroundColor:'#2bd27e' },
        { label:'–ú–ê–§—ã (—à—Ç)', data:zone.volumes.–º–∞—Ñ—ã, backgroundColor:'#f2c94c' }
      ]
    },
    options: {
      responsive:true,
      plugins:{ legend:{ labels:{ color:'#e9edf5' } } },
      scales:{
        x:{ stacked:true, ticks:{ color:'#a3a9b7'} },
        y:{ stacked:true, ticks:{ color:'#a3a9b7'} }
      }
    }
  });

  const budgetTable = document.getElementById("budgetTable");
const deviation = zone.budget.fact - zone.budget.plan;
const percent = ((zone.budget.fact / zone.budget.plan) * 100).toFixed(0);
budgetTable.innerHTML = `
  <tr><th>–ü–æ–∫–∞–∑–∞—Ç–µ–ª—å</th><th>–ü–ª–∞–Ω (‚ÇΩ)</th><th>–§–∞–∫—Ç (‚ÇΩ)</th><th>–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</th><th>% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è</th></tr>
  <tr>
    <td>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç</td>
    <td>${zone.budget.plan.toLocaleString()}</td>
    <td>${zone.budget.fact.toLocaleString()}</td>
    <td>${deviation.toLocaleString()}</td>
    <td>${percent}%</td>
  </tr>
`;

// –≥—Ä–∞—Ñ–∏–∫ —Å–º–µ—Ç—ã
const ctxBudget = document.getElementById('budgetChart').getContext('2d');
new Chart(ctxBudget, {
  type: 'bar',
  data: {
    labels: ['–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞–±–æ—Ç'],
    datasets: [
      { label:'–ü–ª–∞–Ω (‚ÇΩ)', data:[zone.budget.plan], backgroundColor:'#555' },
      { label:'–§–∞–∫—Ç (‚ÇΩ)', data:[zone.budget.fact], backgroundColor:'#ff5c77' }
    ]
  },
  options: {
    responsive:true,
    plugins:{ legend:{ labels:{ color:'#e9edf5' } } },
    scales:{
      x:{ ticks:{ color:'#a3a9b7'} },
      y:{ ticks:{ color:'#a3a9b7'}, beginAtZero:true }
    }
  }
});

  // —Å–≤–æ–¥–∫–∞ –ø–æ –ø–æ–¥—Ä—è–¥—á–∏–∫—É
  document.getElementById("contractorSummary").innerHTML = `
    <tr><th>–í—Å–µ–≥–æ –∑–æ–Ω</th><th>–í—ã–ø–æ–ª–Ω–µ–Ω–æ</th><th>–í –ø—Ä–æ—Ü–µ—Å—Å–µ</th><th>–û—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ</th></tr>
    <tr><td>3</td><td>0</td><td>3</td><td>3</td></tr>
  `;
</script>
</body>
</html>
